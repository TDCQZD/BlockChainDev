# Hyperledger Fabric 共识机制
基于多版本并发控制（Multiversion concurrency control，MVCC）思想的无锁事务机制

- 交易背书：客户端节点根据背书策略，选择背书节点，发送交易提案，背书节点调用智能合约执行模拟交易，执行完成后，经过签名背书，返回给客户端节点，整个过程是模拟的
- 交易排序：排序节点接收已经签名背书的交易，确定交易顺序，将排好序的交易打包成区块，分发给其他组织主节点，排序节点不会去关心交易是否正确，只负责排序和打包区块
- 交易验证：区块存储和交易验证不冲突，区块存储前进行交易验证，fabric中区块状态是世界状态

## 可插拔的共识机制
基于Fabric 1.0.0以后版本，目前fabric提供的共识算法有三种：solo，kafka和PBFT。（0.6版本之前的共识PBFT）

- solo模式
    用于开发测试的单点共识。
- kafka模式
    一种支持多通道分区的集群时序服务，可以容忍部分节点失效（crash），但不能容忍恶意节点，其基于zookeeper进行Paxos算法选举，支持2f+1节点集群，f代表失效节点个数。即kafka可以容忍少于半数的共识节点失效。
- PBFT算法
   以前版本的主流共识算法，也就是拜占庭共识算法。拜占庭算法支持（3f+1）的节点集群，f代表恶意节点的数量。恶意节点可能会做一些恶意伪造时序或者返回相反的错误的结果等。

### 排序服务
1. 在当前可用的版本中，Fabric提供了使用Kafka和Zookeeper实现的CFT(碰撞容错(CFT)共识协议)排序服务。
2. 在随后的版本中，Fabric将提供一个Raft共识排序服务，实现了etcd/Raft和完全分散的BFT(拜占庭容错（BFT）共识协议)排序服务。

consenter，即共识插件，负责接受交易信息进行排序，以及对交易进行切割并打包，打包后返回批量交易。
Orderer包含三种共识插件：
- solo，单节点的排序功能，用于试验。
- kafka，基于Kafka集群的排序实现。支持CFT容错，支持可持久化和可扩展性，可以再生产环境中用。。
- SBFT，支持拜占庭容错的排序实现，尚未完成开发。

