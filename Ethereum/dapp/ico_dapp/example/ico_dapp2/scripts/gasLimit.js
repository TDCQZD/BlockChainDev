const path = require('path');

const Web3 = require('web3');
const HDWalletProvider = require('truffle-hdwallet-provider');
const mnemonic = "blue destroy kind chuckle exist hundred sphere mushroom panel long neither give";
const provider = new HDWalletProvider(mnemonic, "https://ropsten.infura.io/v3/08b9759ea6e748f49463fd0aea86c050");
const web3 = new Web3(provider);

// const web3 = new Web3(new Web3.providers.HttpProvider('https://ropsten.infura.io/v3/08b9759ea6e748f49463fd0aea86c050'));

// 1. get bytecode
var bytecode ='0x'+'608060405234801561001057600080fd5b506000600155611388806100256000396000f3006080604052600436106100565763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663107046bd811461005b578063610a6a2a1461009c578063dcc6012814610104575b600080fd5b34801561006757600080fd5b50610073600435610169565b6040805173ffffffffffffffffffffffffffffffffffffffff9092168252519081900360200190f35b3480156100a857600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526101029436949293602493928401919081908401838280828437509497505084359550505060208301359260400135915061019e9050565b005b34801561011057600080fd5b506101196102ec565b60408051602080825283518183015283519192839290830191858101910280838360005b8381101561015557818101518382015260200161013d565b505050509050019250505060405180910390f35b600080548290811061017757fe5b60009182526020909120015473ffffffffffffffffffffffffffffffffffffffff16905081565b600033858585856101ad61035b565b808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001858152602001848152602001838152602001828103825286818151815260200191508051906020019080838360005b8381101561022b578181015183820152602001610213565b50505050905090810190601f1680156102585780820380516001836020036101000a031916815260200191505b509650505050505050604051809103906000f08015801561027d573d6000803e3d6000fd5b50600080546001810182559080527f290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e56301805473ffffffffffffffffffffffffffffffffffffffff191673ffffffffffffffffffffffffffffffffffffffff929092169190911790555050505050565b6060600080548060200260200160405190810160405280929190818152602001828054801561035157602002820191906000526020600020905b815473ffffffffffffffffffffffffffffffffffffffff168152600190910190602001808311610326575b5050505050905090565b604051610ff18061036c833901905600608060405234801561001057600080fd5b50604051610ff1380380610ff18339810160409081528151602080840151928401516060850151608086015160008054600160a060020a031916600160a060020a038716179055949095018051939590949193909261007491600191870190610089565b50600292909255600355600455506101249050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100ca57805160ff19168380011785556100f7565b828001600101855582156100f7579182015b828111156100f75782518255916020019190600101906100dc565b50610103929150610107565b5090565b61012191905b80821115610103576000815560010161010d565b90565b610ebe806101336000396000f3006080604052600436106100c45763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166303120d4681146100c95780633110235a14610135578063401938831461015c5780634051ddac1461017157806363fd9e38146102415780636f7bc9be146102565780637284e4161461027757806387d81789146103015780638da5cb5b146103c3578063d2b8b867146103f4578063d7bb99ba1461040c578063d7e64c0014610414578063de14c81814610429575b600080fd5b3480156100d557600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526101339436949293602493928401919081908401838280828437509497505084359550505050602090910135600160a060020a03169050610441565b005b34801561014157600080fd5b5061014a6105bf565b60408051918252519081900360200190f35b34801561016857600080fd5b5061014a6105c5565b34801561017d57600080fd5b506101866105cb565b604051808060200189815260200188815260200187815260200186815260200185815260200184815260200183600160a060020a0316600160a060020a0316815260200182810382528a818151815260200191508051906020019080838360005b838110156101ff5781810151838201526020016101e7565b50505050905090810190601f16801561022c5780820380516001836020036101000a031916815260200191505b50995050505050505050505060405180910390f35b34801561024d57600080fd5b5061014a6106c2565b34801561026257600080fd5b5061014a600160a060020a03600435166106c8565b34801561028357600080fd5b5061028c6106da565b6040805160208082528351818301528351919283929083019185019080838360005b838110156102c65781810151838201526020016102ae565b50505050905090810190601f1680156102f35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561030d57600080fd5b50610319600435610767565b604051808060200186815260200185600160a060020a0316600160a060020a0316815260200184151515158152602001838152602001828103825287818151815260200191508051906020019080838360005b8381101561038457818101518382015260200161036c565b50505050905090810190601f1680156103b15780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390f35b3480156103cf57600080fd5b506103d8610852565b60408051600160a060020a039092168252519081900360200190f35b34801561040057600080fd5b50610133600435610861565b610133610aab565b34801561042057600080fd5b5061014a610c63565b34801561043557600080fd5b50610133600435610c69565b610449610dbc565b600054600160a060020a031633146104ab576040805160e560020a62461bcd02815260206004820152601560248201527f4d657373616765206d757374206265204f776e65720000000000000000000000604482015290519081900360640190fd5b506040805160a0810182528481526020808201859052600160a060020a0384169282019290925260006060820181905260808201819052600780546001810180835591909252825180519394919385936005027fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c688019261052f928492910190610df7565b5060208201516001820155604082015160028201805460608501511515740100000000000000000000000000000000000000000274ff000000000000000000000000000000000000000019600160a060020a0390941673ffffffffffffffffffffffffffffffffffffffff1990921691909117929092169190911790556080909101516004909101555050505050565b60035481565b60045481565b60606000806000806000806000600160025460035460045430600160a060020a0316316006546007805490506000809054906101000a9004600160a060020a0316878054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106a15780601f10610676576101008083540402835291602001916106a1565b820191906000526020600020905b81548152906001019060200180831161068457829003601f168201915b50505050509750975097509750975097509750975097509091929394959697565b60025481565b60056020526000908152604090205481565b60018054604080516020600284861615610100026000190190941693909304601f8101849004840282018401909252818152929183018282801561075f5780601f106107345761010080835404028352916020019161075f565b820191906000526020600020905b81548152906001019060200180831161074257829003601f168201915b505050505081565b600780548290811061077557fe5b60009182526020918290206005919091020180546040805160026001841615610100026000190190931692909204601f81018590048502830185019091528082529193509183919083018282801561080e5780601f106107e35761010080835404028352916020019161080e565b820191906000526020600020905b8154815290600101906020018083116107f157829003601f168201915b505050506001830154600284015460049094015492939092600160a060020a03821692507401000000000000000000000000000000000000000090910460ff169085565b600054600160a060020a031681565b60008054600160a060020a031633146108c4576040805160e560020a62461bcd02815260206004820152601560248201527f4d657373616765206d757374206265204f776e65720000000000000000000000604482015290519081900360640190fd5b60078054839081106108d257fe5b906000526020600020906005020190508060020160149054906101000a900460ff1615151561094b576040805160e560020a62461bcd02815260206004820181905260248201527f5061796d656e742073686f756c64206e6f7420626520636f6d706c657465642e604482015290519081900360640190fd5b6001810154303110156109a8576040805160e560020a62461bcd02815260206004820181905260248201527f42616c616e63652073686f756c64206265206c6167676572207061796d656e74604482015290519081900360640190fd5b600654600290048160040154111515610a31576040805160e560020a62461bcd02815260206004820152602760248201527f566f746572732073686f756c64206265206d6f72652068616c66206f6620696e60448201527f766573746f727300000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60028101546001820154604051600160a060020a039092169181156108fc0291906000818181858888f19350505050158015610a71573d6000803e3d6000fd5b50600201805474ff000000000000000000000000000000000000000019167401000000000000000000000000000000000000000017905550565b600254341015610b2b576040805160e560020a62461bcd02815260206004820152602c60248201527f496e766573742076616c75652073686f756c64206265206c617267657220746860448201527f616e206d696e496e766573740000000000000000000000000000000000000000606482015290519081900360840190fd5b600354341115610bab576040805160e560020a62461bcd02815260206004820152602a60248201527f496e766573742076616c75652073686f756c64206265206c657373207468616e60448201527f206d6178496e7665737400000000000000000000000000000000000000000000606482015290519081900360840190fd5b60045430311115610c2c576040805160e560020a62461bcd02815260206004820152603c60248201527f546f74616c20616d6f756e742073686f756c64206e6f7420657863656564207460448201527f6f74616c20616d6f756e74206f662066756e6473207261697365642000000000606482015290519081900360840190fd5b336000908152600560205260409020541515610c4c576006805460010190555b336000908152600560205260409020805434019055565b60065481565b6000600782815481101515610c7a57fe5b6000918252602080832033845260059182905260408420549290910201925011610d14576040805160e560020a62461bcd02815260206004820152602860248201527f4d6573736167652073656e646572206d75737420626520696e766573746f722060448201527f746f20766f746520000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b33600090815260038201602052604090205460ff1615610da4576040805160e560020a62461bcd02815260206004820152602360248201527f4d6573736167652073656e646572206e6f742073686f756c6420626520766f7460448201527f6564200000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b33600052600381016020526004018054600101905550565b60a06040519081016040528060608152602001600081526020016000600160a060020a03168152602001600015158152602001600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610e3857805160ff1916838001178555610e65565b82800160010185558215610e65579182015b82811115610e65578251825591602001919060010190610e4a565b50610e71929150610e75565b5090565b610e8f91905b80821115610e715760008155600101610e7b565b905600a165627a7a7230582019e138fccb336e7e9d521622bdfedff3449d552bf06c790ef4b3c3da0cdb7ce60029a165627a7a72305820676a1cd61ac1eaa4a67cec917491e6f6a70232165b3ec16e4760f0eaf3d9b6210029';


(async () => {
    // 2. get accounts
    let accounts = await web3.eth.getAccounts();
     // 普通交易 gas 估算
    var tx = {from: accounts[0],to: accounts[1],value: 5000000}
    let result = { from: accounts[0],  data:bytecode }
    console.log('pending gas：',web3.eth.getBlock("pending").gasLimit)
    let txGas = await web3.eth.estimateGas(result, function(error, gasAmount){
        console.log('大约要消耗gas：', gasAmount)
    })
    

    // 使用回调函数 估算合约执行方法
    // myContract.methods.myMethod(123)
    // .estimateGas({ gas: 5000000 }, function (error, gasAmount) {
    //      console.log(gasAmount)
    // });

    // // 使用promise 估算合约
    // myContract.methods.myMethod(123).estimateGas({ from: accounts[0] })
    //     .then(function (gasAmount) {
    //         console.log(gasAmount)
    //     })
    //     .catch(function (error) {
    //         console.log(error)
    //     });
})();
