# 侧链


## 如何实现跨链?
目前主要的三种跨链技术： 
公证人机制（Notary schemes）、侧链/中继（Sidechains/relays）、哈希锁定（Hash-locking） 

第一种是有一组同时承担两条链节点的个人或联盟，也有可能是一条单独的链，告诉 B 链 A 链上发生什么事，或者告诉 B 某个消息的真的。比如 Ripple 开发的跨账本价值传输开放协议 Interledger，但它不是链，只是一套网关协议。V 神把这种称为公证人模式（Notary schemes）。

另一种则是侧链 / 中继（Sidechains/relays），与公证人模式的 “别人告诉 B 链 A 链上发生的事” 不同，中继模式则是更 “直接” 地 B 链自己读 A 链。比如通过验证 A 链区块头和默克尔树等信息验证 A 链上的交易，比如以太坊上的 BTC Relay。

哈希锁定，也叫原子互换（Atomic Swap），主要是通过哈希时间锁（hash time lock）和密数（Secret）让双方完成交易，不需要第三方公证人。
## 详解
公证人机制（Notary schemes）：三种方式中最为简单，目前使用的也是比较多的一种方式，举下例子：PBFT协议中，每个节点都是一个公证人，那么你从节点中获得超过三分之二的节点签名，那么就表示这个公证是有效的。或者，在实现锚锭侧链的时候，主链发送交易到侧链时候所拥有的一个多重签名地址，然后需要花费这个交易的时候必须同时提供8-of-10的multisig的签名才是有效。现在使用公证技术的有：字节雪球的witness、ZCASH的6参数生成过程，rootstacke中的semi-trust-free-sidechains（公证方案）。这种方式优点就是简单，整个过程就是对公证节点的信任，缺点就是你需要去信任一或多个实体节点。

侧链/中继（Sidechains/relays）：有些人把这个两个技术分开来说明，这里就放一块解释了。首先有个概念普及下，主链是不知道侧链的存在，侧链则知道主链的存在（其实这个是废话，不知道他怎么做侧链），侧链的概念就是一个链能去读懂另外一个链，用白皮书的定义：sidechain is a blockchain that validates data from other blockchains。侧链存在的条件，一般来说主链通常支持SPV（参考笔者前文比特币架构），主链向侧链提供SPV proof来验证主链中发生的事件（这个事件理解为区块的产生，交易的生成等一系列主链状态的变化）。侧链其实是以锚定比特币为基础的新型区块链，以融合的方式实现加密货币金融生态的目标，而不是像其它加密货币一样排斥现有的系统。中继技术，在A.B两个链中，存在第三方数据结构C，那么这个C就是A和B的中继，如果C也是区块链结构，那么就称relay-chain。举个例子：著名的比特币侧链BTC Relay，一种基于以太坊的智能合约，将以太坊和比特币网络以一种安全去中心化的方式连接起来。 


## 跨链项目
较为知名的跨链项目还有 Cosmos 和 Polkadot，不过都未落地。在 Cosmos 中，不同空间（Zone，独立区块链）通过 IBC（区块链通信）协议分别和 “中心”（Hub，管理众多 Zone）通信，不同空间的信息包裹经过中心传输。为了保证传输无误，一个证明（Merkle-proof）需要被发布在接收方的区块链上。接收方为了验证这个证明，需要时刻了解发送方的区块头，类似侧链采用的机制。

Polkadot 中继链的区块包含平行链的区块头，还有一些确认信息，以避免双花。验证人负责运营中继链节点，并验证平行链上的区块；可能还会有一个收集人运行特定平行链的全节点，负责提交新区块。

万维链暂时使用的方式，是哈希锁定，也叫原子互换（Atomic Swap），主要是通过哈希时间锁（hash time lock）和密数（Secret）让双方完成交易，不需要第三方公证人。这个方式通俗来说可以这样理解：

假设小明要转 10 个 ETH 给小红，小红要转 10 个 wan 给小明；

小明在以太坊一智能合约里锁了 10 个 ETH 加上一个密码的哈希值，并置入条件：如果小红在 10 小时内提供了密码，合约验证之后小红就能获得 10 个 ETH，否则回滚；

小红在万维链一智能合约里锁了 100 个 wan 并把密码的哈希值放在里面，并置入条件如果小明在 5 小时内提供了密码，就能获得100 个 wan；

小明看到小红在 wan 也锁了钱，就凭密码到 wan 上拿走了 100wan；

小红也从 wan 上的合约中得知密码，凭密码到 ETH 合约中拿走 10 个 ETH。

我们可以把小红换成万维链的 Storeman，用户（小明）只需要在发起交易、释放密数、撤销交易的环节进行操作。对于参与跨链的 Storeman，万维链会提供专门的客户端，客户端根据协议进行无需值守的自动化运行。这是一个比较成熟的方案，闪电网络用的也是这个，安全度高不过似乎应用场景比较少。

如果是单纯两个用户交换资产，其实哈希锁定是个挺安全的方式（不过用户体验不太友好），而且只靠哈希锁定就能完成。这跟上面两种不太一样，哈希锁定还能可以跟第一种结合使用，万维链目前就是这么做；闪电网络就是哈希锁定+多签。